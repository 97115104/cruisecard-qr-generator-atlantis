<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QR Lock Screen Remix | Atlantis</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üö¢</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff006e;
            --primary-glow: rgba(255, 0, 110, 0.15);
            --bg: #f5f5f5;
            --bg-card: #ffffff;
            --text-primary: #333;
            --text-secondary: #666;
            --text-muted: #999;
            --border: #e0e0e0;
            --success: #00cc88;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Outfit', -apple-system, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            animation: fadeInUp 0.6s ease-out;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 16px;
            padding: 10px 16px;
            background: white;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .back-link:hover {
            color: var(--primary);
        }

        .card {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 28px 24px;
            margin-bottom: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }

        h1 {
            color: var(--primary);
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 14px;
            margin-top: 22px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section-title:first-of-type {
            margin-top: 0;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 13px;
        }

        .optional-tag {
            color: var(--text-muted);
            font-weight: 400;
        }

        select,
        input[type="file"],
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            background: white;
            color: var(--text-primary);
            transition: all 0.3s;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 18px;
            padding-right: 44px;
            cursor: pointer;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-glow);
        }

        input[type="file"] {
            padding: 10px 12px;
            font-size: 14px;
        }

        input[type="file"]::file-selector-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 8px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            margin-right: 10px;
        }

        .status-text {
            margin-top: 6px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .status-text.success {
            color: var(--success);
        }

        .theme-preview-box {
            margin-top: 12px;
            padding: 14px;
            background: #fff0f5;
            border-radius: 12px;
            border: 1px solid rgba(255, 0, 110, 0.15);
            display: none;
        }

        .theme-preview-box.show {
            display: block;
            animation: fadeInUp 0.3s ease-out;
        }

        .theme-preview-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .theme-preview-icon {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .theme-preview-icon.transparent-bg {
            background: transparent !important;
            border: 2px dashed #ccc;
        }

        .theme-preview-title {
            font-weight: 700;
            font-size: 15px;
        }

        .theme-preview-title.glass-font {
            font-family: 'Inter', -apple-system, sans-serif;
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        .theme-preview-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .generate-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 8px;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 0, 110, 0.4);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #preview {
            display: none;
            text-align: center;
        }

        #preview.show {
            display: block;
            animation: fadeInUp 0.5s ease-out;
        }

        #wallpaperCanvas {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            margin: 16px 0;
        }

        .download-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 0, 110, 0.4);
        }

        .tip-box {
            margin-top: 14px;
            padding: 14px;
            background: #fff0f5;
            border-left: 4px solid var(--primary);
            border-radius: 8px;
            font-size: 13px;
            text-align: left;
        }

        .tip-box strong {
            color: var(--primary);
        }

        /* Quote Options Styling */
        .quote-options {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .quote-option-btn {
            flex: 1;
            padding: 10px 14px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-secondary);
        }

        .quote-option-btn.active {
            border-color: var(--primary);
            background: rgba(255, 0, 110, 0.1);
            color: var(--primary);
        }

        .quote-option-btn:hover:not(.active) {
            border-color: var(--primary);
        }

        .custom-quote-input {
            display: none;
        }

        .custom-quote-input.show {
            display: block;
            animation: fadeInUp 0.3s ease-out;
        }

        .random-quote-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        .random-quote-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        #quotePreview {
            margin-top: 8px;
            padding: 10px;
            background: rgba(255, 240, 245, 0.8);
            border-radius: 8px;
            font-size: 13px;
            font-style: italic;
            color: var(--text-secondary);
            display: none;
        }

        #quotePreview.show {
            display: block;
        }

        /* Wallpaper Section */
        .wallpaper-preview {
            margin-top: 10px;
            width: 100%;
            height: 80px;
            border-radius: 10px;
            background-size: cover;
            background-position: center;
            display: none;
            position: relative;
            overflow: hidden;
        }

        .wallpaper-preview.show {
            display: block;
        }

        .wallpaper-preview::after {
            content: 'Wallpaper Set';
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0, 204, 136, 0.9);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }

        .clear-wallpaper-btn {
            display: none;
            margin-top: 8px;
            padding: 8px 14px;
            background: transparent;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.3s;
        }

        .clear-wallpaper-btn.show {
            display: inline-block;
        }

        .clear-wallpaper-btn:hover {
            border-color: #ff4444;
            color: #ff4444;
        }

        @media (max-width: 480px) {
            body {
                padding: 16px;
            }

            .card {
                padding: 22px 18px;
            }

            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <a href="index.html" class="back-link">Back to Cruise Card</a>
        <div class="card">
            <h1>Atlantis Lock Screen Remix</h1>
            <p class="subtitle">Create a custom wallpaper with your QR code</p>

            <div class="section-title">Upload QR Code</div>
            <div class="form-group">
                <label>QR Code Image <span class="optional-tag">(auto-imported if coming from generator)</span></label>
                <input type="file" id="qrUpload" accept="image/*">
                <div id="qrStatus" class="status-text"></div>
            </div>

            <div class="section-title">Profile Photo</div>
            <div class="form-group">
                <label>Your Photo <span class="optional-tag">(optional)</span></label>
                <input type="file" id="photoUpload" accept="image/*">
                <div id="photoStatus" class="status-text"></div>
            </div>

            <div class="section-title">Your Details</div>
            <div class="form-group">
                <label>Cabin Number *</label>
                <input type="text" id="cabinNumber" placeholder="6969" inputmode="numeric">
            </div>
            <div class="form-group">
                <label>Where are you from? <span class="optional-tag">(optional)</span></label>
                <input type="text" id="location" placeholder="Los Angeles, CA">
            </div>

            <div class="section-title">Phone Screen Size</div>
            <div class="form-group">
                <select id="phoneModel">
                    <option value="1290,2796">iPhone 16 Pro Max / 15 Pro Max</option>
                    <option value="1179,2556">iPhone 15 Pro / 14 Pro Max</option>
                    <option value="1170,2532">iPhone 15 / 14 / 13 / 12</option>
                    <option value="1284,2778">iPhone 14 Plus / 13 Pro Max</option>
                    <option value="1125,2436">iPhone X / XS / 11 Pro</option>
                    <option value="1080,2400">Android Standard</option>
                    <option value="1440,3200">Android XL / Samsung Galaxy</option>
                </select>
            </div>

            <div class="section-title">Choose Your Theme</div>
            <div class="form-group">
                <select id="themeSelect">
                    <option value="">‚Äî Select a theme ‚Äî</option>
                    <option value="lostcity">üî± Lost City ‚Äî Underwater Atlantis</option>
                    <option value="wild">ü¶Å Wild! ‚Äî Jungle Energy</option>
                    <option value="neon">üéÆ Neon Playground ‚Äî Flashy & Fun</option>
                    <option value="whiteheat">üî• White Heat ‚Äî Elegant White</option>
                    <option value="dogtag">ü™ñ Dog Tag ‚Äî Military Tribute</option>
                    <option value="disco">üï∫ Revival! Disco ‚Äî 70s Vibes</option>
                    <option value="pink">üíï Twisted Pink ‚Äî Barbie Dreams</option>
                    <option value="glass">ü™ü Glass ‚Äî Apple-style Minimal</option>
                    <option value="basic">üñ§ Basic Black ‚Äî Clean & Simple</option>
                    <option value="fabulous">üè≥Ô∏è‚Äçüåà Fabulous ‚Äî Rainbow Pride</option>
                    <option value="atlantis1">üö¢ Atlantis T-Dance ‚Äî Deck Party</option>
                    <option value="atlantis2">üåà Atlantis Pride ‚Äî Rainbow Party</option>
                </select>
                <div class="theme-preview-box" id="themePreview">
                    <div class="theme-preview-header">
                        <div class="theme-preview-icon" id="themeIcon"></div>
                        <div class="theme-preview-title" id="themeTitle">Lost City</div>
                    </div>
                    <div class="theme-preview-desc" id="themeDesc"></div>
                </div>
            </div>

            <div class="section-title">Custom Background <span class="optional-tag">(optional)</span></div>
            <div class="form-group">
                <label>Upload Your Own Wallpaper</label>
                <input type="file" id="wallpaperUpload" accept="image/*">
                <div id="wallpaperStatus" class="status-text">This will replace the theme background</div>
                <div class="wallpaper-preview" id="wallpaperPreview"></div>
                <button class="clear-wallpaper-btn" id="clearWallpaper">Remove Wallpaper</button>
            </div>

            <div class="section-title">Quote</div>
            <div class="form-group">
                <div class="quote-options">
                    <button class="quote-option-btn active" id="randomQuoteBtn" data-mode="random">Random</button>
                    <button class="quote-option-btn" id="customQuoteBtn" data-mode="custom">Custom</button>
                    <button class="quote-option-btn" id="noQuoteBtn" data-mode="none">No Quote</button>
                </div>
                <div class="custom-quote-input" id="customQuoteSection">
                    <textarea id="customQuote" placeholder="Enter your custom quote..." maxlength="100"></textarea>
                </div>
                <button class="random-quote-btn" id="shuffleQuote">Shuffle Quote</button>
                <div id="quotePreview"></div>
            </div>

            <button class="generate-btn" id="generateBtn" disabled>Generate Wallpaper</button>
        </div>

        <div class="card" id="preview">
            <div class="section-title">Your Custom Lock Screen</div>
            <canvas id="wallpaperCanvas"></canvas>
            <button class="download-btn" id="downloadBtn">Download Wallpaper</button>
            <div class="tip-box"><strong>Tip:</strong> After downloading, go to Settings then Wallpaper and select this
                image.</div>
        </div>
    </div>

    <script>
        let qrImage = null, profileImage = null, selectedTheme = null, cabinNumber = '', userLocation = '';
        let customWallpaper = null;
        let quoteMode = 'random';
        let currentRandomQuote = '';

        // Preload background images for photo-based themes
        const bgImages = {};
        const bgImagePaths = {
            atlantis1: 'backgrounds/atlantis1.jpg',
            atlantis2: 'backgrounds/atlantis2.jpg',
            fabulous: 'backgrounds/fab1.jpg'
        };

        // Preload images
        Object.keys(bgImagePaths).forEach(key => {
            const img = new Image();
            img.onload = () => { bgImages[key] = img; };
            img.src = bgImagePaths[key];
        });

        // Get current year dynamically
        const currentYear = new Date().getFullYear();

        const themeData = {
            lostcity: { icon: 'üî±', title: 'Lost City', desc: 'Dive deep into underwater Atlantis. Mermaids, mermen, and everyone in between.', gradient: 'linear-gradient(135deg, #001f3f, #0066cc)', isGlass: false },
            wild: { icon: 'ü¶Å', title: 'Wild!', desc: 'Unleash your inner animal. May cause spontaneous roaring.', gradient: 'linear-gradient(135deg, #0a4d3c, #2d5016)', isGlass: false },
            neon: { icon: 'üéÆ', title: 'Neon Playground', desc: 'Bright, flashy, unapologetically extra. Like your ex, but fun.', gradient: 'linear-gradient(135deg, #ff00ff, #00ffff)', isGlass: false },
            whiteheat: { icon: 'üî•', title: 'White Heat', desc: 'All white everything. Looking like a bleach commercial is a serve.', gradient: 'linear-gradient(135deg, #fff, #e8e8e8)', isGlass: false },
            dogtag: { icon: 'ü™ñ', title: 'Dog Tag', desc: 'Small uniforms, big energy. Don\'t ask, just dance.', gradient: 'linear-gradient(135deg, #4a5568, #2d3748)', isGlass: false },
            disco: { icon: 'üï∫', title: 'Revival! Disco', desc: 'Bell bottoms and chest hair. Studio 54 wishes.', gradient: 'linear-gradient(135deg, #ffd700, #ff6b6b)', isGlass: false },
            pink: { icon: 'üíï', title: 'Twisted Pink', desc: 'Barbie meets bear. Ken is shook.', gradient: 'linear-gradient(135deg, #ff69b4, #ffc0cb)', isGlass: false },
            glass: { icon: 'ü™ü', title: 'Glass', desc: 'Clean, minimal, Apple-inspired transparency.', gradient: 'none', isGlass: true },
            basic: { icon: 'üñ§', title: 'Basic Black', desc: 'Simple, elegant, timeless. Pure black sophistication.', gradient: 'linear-gradient(135deg, #1a1a1a, #000000)', isGlass: false },
            fabulous: { icon: 'üè≥Ô∏è‚Äçüåà', title: 'Fabulous', desc: 'Loud, proud, and covered in rainbows. Slay queen!', gradient: 'linear-gradient(135deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #8b00ff)', isGlass: false },
            atlantis1: { icon: 'üö¢', title: 'Atlantis T-Dance', desc: 'The legendary deck party. Dog Tag vibes with thousands of your closest friends.', gradient: 'linear-gradient(135deg, #1a5276, #2980b9)', isGlass: false },
            atlantis2: { icon: 'üåà', title: 'Atlantis Pride', desc: 'Rainbow explosion on the high seas. Pure joy and celebration.', gradient: 'linear-gradient(135deg, #ff6b6b, #ffd93d, #6bcb77, #4d96ff)', isGlass: false }
        };

        const funnyQuotes = [
            "I'm not gay but my boyfriend is üíÖ", "Slay the day away ‚ú®", "Sorry can't hear you over my outfit üëó",
            "Too glam to give a damn üíÑ", "My ship has come in... literally üö¢", "Professional homosexual üíº",
            "Cher is my spirit animal ü¶Ñ", "Body-ody-ody-ody üçë", "Main character energy only ‚≠ê",
            "Not a phase, Mom üåà", "Beyonc√© said I look good üêù", "The category is: REALNESS üíÉ",
            "Probably thinking about brunch ü•Ç", "My other ride is a disco ball ü™©", "Fluent in Drag Race üë†",
            "Warning: May burst into song üé§", "Handle with care: contains glitter üíñ", "Yes I'm this extra IRL ‚ú®",
            "If lost, return to dance floor ü™©", "Charisma, Uniqueness, Nerve & Tan üëë", "Making choices since birth ü§≠",
            "Here for a good time üéâ", "Powered by iced coffee & anxiety ‚òï", "Born this way üåà"
        ];

        // Initialize with a random quote
        function getRandomQuote() {
            return funnyQuotes[Math.floor(Math.random() * funnyQuotes.length)];
        }

        currentRandomQuote = getRandomQuote();

        function updateQuotePreview() {
            const previewEl = document.getElementById('quotePreview');
            const shuffleBtn = document.getElementById('shuffleQuote');
            
            if (quoteMode === 'none') {
                previewEl.textContent = '(No quote will be displayed)';
                previewEl.classList.add('show');
                shuffleBtn.style.display = 'none';
            } else if (quoteMode === 'custom') {
                const customText = document.getElementById('customQuote').value.trim();
                previewEl.textContent = customText ? `"${customText}"` : '(Enter your quote above)';
                previewEl.classList.add('show');
                shuffleBtn.style.display = 'none';
            } else {
                previewEl.textContent = `"${currentRandomQuote}"`;
                previewEl.classList.add('show');
                shuffleBtn.style.display = 'inline-flex';
            }
        }

        // Quote mode toggle
        document.querySelectorAll('.quote-option-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.quote-option-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                quoteMode = this.dataset.mode;
                
                const customSection = document.getElementById('customQuoteSection');
                
                if (quoteMode === 'custom') {
                    customSection.classList.add('show');
                } else {
                    customSection.classList.remove('show');
                }
                updateQuotePreview();
            });
        });

        // Shuffle quote button
        document.getElementById('shuffleQuote').addEventListener('click', function() {
            currentRandomQuote = getRandomQuote();
            updateQuotePreview();
        });

        // Custom quote input
        document.getElementById('customQuote').addEventListener('input', updateQuotePreview);

        // Initialize quote preview
        updateQuotePreview();

        window.addEventListener('load', function () {
            const qrData = sessionStorage.getItem('qrData');
            const savedCabin = sessionStorage.getItem('cabinNumber');
            if (qrData) {
                const img = new Image();
                img.onload = function () { qrImage = img; document.getElementById('qrStatus').textContent = 'QR imported'; document.getElementById('qrStatus').classList.add('success'); checkReady(); };
                img.src = qrData;
            }
            if (savedCabin) { document.getElementById('cabinNumber').value = savedCabin; cabinNumber = savedCabin; checkReady(); }
        });

        document.getElementById('cabinNumber').addEventListener('input', function () { cabinNumber = this.value.trim(); checkReady(); });
        document.getElementById('location').addEventListener('input', function () { userLocation = this.value.trim(); });

        document.getElementById('themeSelect').addEventListener('change', function () {
            selectedTheme = this.value;
            const previewBox = document.getElementById('themePreview');
            if (selectedTheme && themeData[selectedTheme]) {
                const data = themeData[selectedTheme];
                const iconEl = document.getElementById('themeIcon');
                const titleEl = document.getElementById('themeTitle');
                
                iconEl.textContent = data.icon;
                
                // Handle glass theme specially - transparent background and different font
                if (data.isGlass) {
                    iconEl.style.background = 'transparent';
                    iconEl.classList.add('transparent-bg');
                    titleEl.classList.add('glass-font');
                } else {
                    iconEl.style.background = data.gradient;
                    iconEl.classList.remove('transparent-bg');
                    titleEl.classList.remove('glass-font');
                }
                
                titleEl.textContent = data.title;
                document.getElementById('themeDesc').textContent = data.desc;
                previewBox.classList.add('show');
            } else { previewBox.classList.remove('show'); }
            checkReady();
        });

        document.getElementById('qrUpload').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const img = new Image();
                    img.onload = function () { qrImage = img; document.getElementById('qrStatus').textContent = 'Uploaded'; document.getElementById('qrStatus').classList.add('success'); checkReady(); };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('photoUpload').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const img = new Image();
                    img.onload = function () { profileImage = img; document.getElementById('photoStatus').textContent = 'Uploaded'; document.getElementById('photoStatus').classList.add('success'); };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Custom wallpaper upload
        document.getElementById('wallpaperUpload').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const img = new Image();
                    img.onload = function () {
                        customWallpaper = img;
                        document.getElementById('wallpaperStatus').textContent = 'Wallpaper uploaded';
                        document.getElementById('wallpaperStatus').classList.add('success');
                        document.getElementById('wallpaperPreview').style.backgroundImage = `url(${event.target.result})`;
                        document.getElementById('wallpaperPreview').classList.add('show');
                        document.getElementById('clearWallpaper').classList.add('show');
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Clear wallpaper button
        document.getElementById('clearWallpaper').addEventListener('click', function() {
            customWallpaper = null;
            document.getElementById('wallpaperUpload').value = '';
            document.getElementById('wallpaperStatus').textContent = 'This will replace the theme background';
            document.getElementById('wallpaperStatus').classList.remove('success');
            document.getElementById('wallpaperPreview').style.backgroundImage = '';
            document.getElementById('wallpaperPreview').classList.remove('show');
            document.getElementById('clearWallpaper').classList.remove('show');
        });

        function checkReady() { document.getElementById('generateBtn').disabled = !(qrImage && selectedTheme && cabinNumber); }

        document.getElementById('generateBtn').addEventListener('click', generateWallpaper);



        function generateWallpaper() {
            const [width, height] = document.getElementById('phoneModel').value.split(',').map(Number);
            const canvas = document.getElementById('wallpaperCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = width;
            canvas.height = height;

            const scale = width / 1170;

            // Draw custom wallpaper or theme
            if (customWallpaper) {
                drawCustomWallpaper(ctx, width, height, customWallpaper);
            } else {
                drawTheme(ctx, width, height, scale, selectedTheme);
            }

            const hasPhoto = profileImage !== null;
            const hasLocation = userLocation.length > 0;
            
            // Determine text color based on theme
            const useBlackText = (selectedTheme === 'whiteheat' || selectedTheme === 'glass');

            ctx.textAlign = 'center';
            ctx.shadowColor = useBlackText ? 'rgba(255,255,255,0.6)' : 'rgba(0,0,0,0.6)';

            // Global offsets
            const topSafeOffset = height * 0.245 + height * 0.015; // downward shift + 1.5%
            const spacingCompression = 0.90; // tighten overall gaps by 2%

            /* 1. TITLE - Use Inter font for glass theme */
            ctx.fillStyle = useBlackText ? 'rgba(0,0,0,0.9)' : 'white';
            if (selectedTheme === 'glass') {
                ctx.font = `300 ${Math.round(72 * scale)}px 'Inter', sans-serif`;
            } else {
                ctx.font = `800 ${Math.round(78 * scale)}px 'Outfit', sans-serif`;
            }
            ctx.shadowBlur = 25 * scale;
            ctx.fillText(
                `ATLANTIS ${currentYear}`,
                width / 2,
                height * 0.08 * spacingCompression + topSafeOffset
            );

            /* 2. PROFILE PHOTO (previously 3% bigger + 2% bigger now) */
            let photoBottom = 0;
            if (hasPhoto) {
                let photoSize = width * 0.38 * 0.8; // original 20% smaller
                photoSize *= 1.03; // previous 3% bigger
                photoSize *= 1.02; // +2% bigger now
                const photoX = (width - photoSize) / 2;

                // Reduce gap between title and profile photo by 2%
                const photoY = height * 0.13 * spacingCompression + topSafeOffset - height * 0.02;

                ctx.beginPath();
                ctx.arc(
                    photoX + photoSize / 2,
                    photoY + photoSize / 2,
                    photoSize / 2 + 9 * scale,
                    0,
                    Math.PI * 2
                );
                ctx.fillStyle = useBlackText ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.95)';
                ctx.shadowBlur = 32 * scale;
                ctx.shadowOffsetY = 10 * scale;
                ctx.fill();

                ctx.shadowBlur = 0;
                ctx.shadowOffsetY = 0;

                ctx.save();
                ctx.beginPath();
                ctx.arc(
                    photoX + photoSize / 2,
                    photoY + photoSize / 2,
                    photoSize / 2,
                    0,
                    Math.PI * 2
                );
                ctx.clip();

                const imgAspect = profileImage.width / profileImage.height;
                let drawW, drawH, drawX, drawY;

                if (imgAspect > 1) {
                    drawH = photoSize;
                    drawW = drawH * imgAspect;
                    drawX = photoX - (drawW - photoSize) / 2;
                    drawY = photoY;
                } else {
                    drawW = photoSize;
                    drawH = drawW / imgAspect;
                    drawX = photoX;
                    drawY = photoY - (drawH - photoSize) / 2;
                }

                ctx.drawImage(profileImage, drawX, drawY, drawW, drawH);
                ctx.restore();

                photoBottom = photoY + photoSize;
            }

            /* 3. CABIN (reduce gap with profile photo by 5%) */
            const cabinY = hasPhoto
                ? photoBottom + height * 0.05 // 5% gap from photo bottom
                : height * 0.20 * spacingCompression + topSafeOffset;

            ctx.fillStyle = useBlackText ? 'rgba(0,0,0,0.7)' : 'rgba(255,255,255,0.85)';
            if (selectedTheme === 'glass') {
                ctx.font = `400 ${Math.round(34 * scale)}px 'Inter', sans-serif`;
            } else {
                ctx.font = `700 ${Math.round(36 * scale)}px 'Outfit', sans-serif`;
            }
            ctx.shadowBlur = 12 * scale;
            ctx.fillText('CABIN', width / 2, cabinY);

            ctx.fillStyle = useBlackText ? 'rgba(0,0,0,0.9)' : 'white';
            if (selectedTheme === 'glass') {
                ctx.font = `500 ${Math.round(96 * scale)}px 'Inter', sans-serif`;
            } else {
                ctx.font = `800 ${Math.round(104 * scale)}px 'Outfit', sans-serif`;
            }
            ctx.shadowBlur = 18 * scale;
            ctx.fillText(cabinNumber, width / 2, cabinY + 88 * scale);

            const cabinBottom = cabinY + 88 * scale;

            /* 4. QR CODE - Simple classic style only */
            const qrSize = width * 0.40 * 0.8; // 20% smaller
            const qrX = (width - qrSize) / 2;
            const qrY = cabinBottom + height * 0.03;
            const qrPad = 24 * scale;

            // Classic QR style
            ctx.fillStyle = 'rgba(255,255,255,0.97)';
            ctx.shadowBlur = 30 * scale;
            ctx.shadowColor = 'rgba(0,0,0,0.3)';
            ctx.shadowOffsetY = 10 * scale;
            roundRect(ctx, qrX - qrPad, qrY - qrPad, qrSize + qrPad * 2, qrSize + qrPad * 2, 26 * scale);
            ctx.fill();
            ctx.shadowBlur = 0;
            ctx.shadowOffsetY = 0;
            ctx.drawImage(qrImage, qrX, qrY, qrSize, qrSize);

            // Reset shadow color for text
            ctx.shadowColor = useBlackText ? 'rgba(255,255,255,0.6)' : 'rgba(0,0,0,0.6)';

            /* 5. LOCATION (below QR) - with pin emoji */
            if (hasLocation) {
                ctx.fillStyle = useBlackText ? 'rgba(0,0,0,0.8)' : 'rgba(255,255,255,0.9)';
                if (selectedTheme === 'glass') {
                    ctx.font = `400 ${Math.round(38 * scale)}px 'Inter', sans-serif`;
                } else {
                    ctx.font = `600 ${Math.round(40 * scale)}px 'Outfit', sans-serif`;
                }
                ctx.shadowBlur = 12 * scale;

                const locationY = qrY + qrSize + height * 0.036;
                ctx.fillText('üìç ' + userLocation, width / 2, locationY);
            }

            /* 6. QUOTE (below QR, slightly lower than location) - only if not 'none' mode */
            if (quoteMode !== 'none') {
                let quote = '';
                if (quoteMode === 'custom') {
                    quote = document.getElementById('customQuote').value.trim();
                } else {
                    quote = currentRandomQuote;
                }
                
                if (quote) {
                    ctx.fillStyle = useBlackText ? 'rgba(0,0,0,0.7)' : 'rgba(255,255,255,0.85)';
                    // Quote text 3% bigger: 32 * 1.03 = ~33
                    if (selectedTheme === 'glass') {
                        ctx.font = `300 ${Math.round(33 * scale)}px 'Inter', sans-serif`;
                    } else {
                        ctx.font = `500 ${Math.round(33 * scale)}px 'Outfit', sans-serif`;
                    }

                    const maxW = width - 100 * scale;
                    const words = quote.split(' ');
                    let line = '';
                    const lines = [];

                    for (let word of words) {
                        const test = line + word + ' ';
                        if (ctx.measureText(test).width > maxW && line) {
                            lines.push(line.trim());
                            line = word + ' ';
                        } else {
                            line = test;
                        }
                    }
                    lines.push(line.trim());

                    const quoteY = qrY + qrSize + height * 0.072;
                    lines.forEach((l, i) =>
                        ctx.fillText(l, width / 2, quoteY + i * 42 * scale)
                    );
                }
            }

            ctx.shadowBlur = 0;

            document.getElementById('preview').classList.add('show');
            document.getElementById('preview').scrollIntoView({ behavior: 'smooth' });
        }


        function roundRect(ctx, x, y, w, h, r) {
            ctx.beginPath();
            ctx.moveTo(x + r, y); ctx.lineTo(x + w - r, y); ctx.quadraticCurveTo(x + w, y, x + w, y + r);
            ctx.lineTo(x + w, y + h - r); ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
            ctx.lineTo(x + r, y + h); ctx.quadraticCurveTo(x, y + h, x, y + h - r);
            ctx.lineTo(x, y + r); ctx.quadraticCurveTo(x, y, x + r, y);
            ctx.closePath();
        }

        function drawCustomWallpaper(ctx, w, h, img) {
            // Draw custom wallpaper covering the canvas
            const imgAspect = img.width / img.height;
            const canvasAspect = w / h;
            let drawW, drawH, drawX, drawY;

            if (imgAspect > canvasAspect) {
                drawH = h;
                drawW = drawH * imgAspect;
                drawX = (w - drawW) / 2;
                drawY = 0;
            } else {
                drawW = w;
                drawH = drawW / imgAspect;
                drawX = 0;
                drawY = (h - drawH) / 2;
            }

            ctx.drawImage(img, drawX, drawY, drawW, drawH);

            // Add a subtle dark overlay for better text readability
            ctx.fillStyle = 'rgba(0, 0, 0, 0.25)';
            ctx.fillRect(0, 0, w, h);
        }

        function drawPhotoBackground(ctx, w, h, img) {
            // Draw photo background covering the canvas
            const imgAspect = img.width / img.height;
            const canvasAspect = w / h;
            let drawW, drawH, drawX, drawY;

            if (imgAspect > canvasAspect) {
                drawH = h;
                drawW = drawH * imgAspect;
                drawX = (w - drawW) / 2;
                drawY = 0;
            } else {
                drawW = w;
                drawH = drawW / imgAspect;
                drawX = 0;
                drawY = (h - drawH) / 2;
            }

            ctx.drawImage(img, drawX, drawY, drawW, drawH);

            // Add overlay for better text readability
            ctx.fillStyle = 'rgba(0, 0, 0, 0.35)';
            ctx.fillRect(0, 0, w, h);
        }

        function drawTheme(ctx, w, h, s, theme) {
            const themes = { 
                lostcity: drawLostCity, 
                wild: drawWild, 
                neon: drawNeon, 
                whiteheat: drawWhiteHeat, 
                dogtag: drawDogTag, 
                disco: drawDisco, 
                pink: drawPink,
                glass: drawGlass,
                basic: drawBasic,
                fabulous: drawFabulous,
                atlantis1: drawAtlantis1,
                atlantis2: drawAtlantis2
            };
            themes[theme](ctx, w, h, s);
        }

        // ATLANTIS 1 - T-Dance photo background
        function drawAtlantis1(ctx, w, h, s) {
            if (bgImages.atlantis1) {
                drawPhotoBackground(ctx, w, h, bgImages.atlantis1);
            } else {
                // Fallback gradient if image not loaded
                const grad = ctx.createLinearGradient(0, 0, 0, h);
                grad.addColorStop(0, '#1a5276');
                grad.addColorStop(1, '#2980b9');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, w, h);
            }
        }

        // ATLANTIS 2 - Pride party photo background
        function drawAtlantis2(ctx, w, h, s) {
            if (bgImages.atlantis2) {
                drawPhotoBackground(ctx, w, h, bgImages.atlantis2);
            } else {
                // Fallback gradient if image not loaded
                const grad = ctx.createLinearGradient(0, 0, 0, h);
                grad.addColorStop(0, '#ff6b6b');
                grad.addColorStop(0.33, '#ffd93d');
                grad.addColorStop(0.66, '#6bcb77');
                grad.addColorStop(1, '#4d96ff');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, w, h);
            }
        }

        // GLASS - No background at all (transparent/clear)
        function drawGlass(ctx, w, h, s) {
            // Completely transparent - no background
            ctx.clearRect(0, 0, w, h);
            
            // Optional: very faint white to ensure it's not fully transparent
            ctx.fillStyle = 'rgba(255, 255, 255, 0.02)';
            ctx.fillRect(0, 0, w, h);
        }

        // BASIC - Clean black
        function drawBasic(ctx, w, h, s) {
            // Pure black gradient with subtle depth
            const grad = ctx.createLinearGradient(0, 0, 0, h);
            grad.addColorStop(0, '#0a0a0a');
            grad.addColorStop(0.5, '#000000');
            grad.addColorStop(1, '#0d0d0d');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, w, h);

            // Very subtle vignette
            const vignette = ctx.createRadialGradient(w / 2, h / 2, 0, w / 2, h / 2, Math.max(w, h) * 0.7);
            vignette.addColorStop(0, 'rgba(30, 30, 30, 0.1)');
            vignette.addColorStop(1, 'rgba(0, 0, 0, 0.3)');
            ctx.fillStyle = vignette;
            ctx.fillRect(0, 0, w, h);
        }

        // FABULOUS - Rainbow pride with photo background
        function drawFabulous(ctx, w, h, s) {
            if (bgImages.fabulous) {
                drawPhotoBackground(ctx, w, h, bgImages.fabulous);
            } else {
                // Fallback: Rainbow stripes background
                const stripeHeight = h / 6;
                const rainbowColors = ['#FF0018', '#FFA52C', '#FFFF41', '#008018', '#0000F9', '#86007D'];
                
                rainbowColors.forEach((color, i) => {
                    ctx.fillStyle = color;
                    ctx.fillRect(0, i * stripeHeight, w, stripeHeight + 1);
                });

                // Add sparkle/glitter effect
                for (let i = 0; i < 100; i++) {
                    const x = Math.random() * w;
                    const y = Math.random() * h;
                    const r = (2 + Math.random() * 6) * s;
                    const g = ctx.createRadialGradient(x, y, 0, x, y, r * 2);
                    g.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
                    g.addColorStop(0.5, 'rgba(255, 255, 255, 0.4)');
                    g.addColorStop(1, 'rgba(255, 255, 255, 0)');
                    ctx.fillStyle = g;
                    ctx.beginPath();
                    ctx.arc(x, y, r * 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }

        // LOST CITY - Deep ocean with bioluminescence
        function drawLostCity(ctx, w, h, s) {
            const grad = ctx.createLinearGradient(0, 0, 0, h);
            grad.addColorStop(0, '#000a14'); grad.addColorStop(0.4, '#001a33'); grad.addColorStop(0.7, '#003366'); grad.addColorStop(1, '#0066aa');
            ctx.fillStyle = grad; ctx.fillRect(0, 0, w, h);

            // Light rays from surface
            ctx.globalAlpha = 0.1;
            for (let i = 0; i < 6; i++) {
                const x = w * (0.15 + i * 0.14);
                ctx.beginPath(); ctx.moveTo(x - 40 * s, 0); ctx.lineTo(x + 40 * s, 0); ctx.lineTo(x + 150 * s, h); ctx.lineTo(x - 150 * s, h);
                ctx.fillStyle = '#00ffff'; ctx.fill();
            }
            ctx.globalAlpha = 1;

            // Bioluminescent particles
            for (let i = 0; i < 40; i++) {
                const x = Math.random() * w, y = Math.random() * h, r = (3 + Math.random() * 5) * s;
                const glow = ctx.createRadialGradient(x, y, 0, x, y, r * 4);
                glow.addColorStop(0, 'rgba(0, 255, 220, 0.7)'); glow.addColorStop(1, 'rgba(0, 255, 220, 0)');
                ctx.fillStyle = glow; ctx.beginPath(); ctx.arc(x, y, r * 4, 0, Math.PI * 2); ctx.fill();
            }
        }

        // WILD - Dense jungle with fireflies
        function drawWild(ctx, w, h, s) {
            const grad = ctx.createLinearGradient(0, 0, 0, h);
            grad.addColorStop(0, '#021a02'); grad.addColorStop(0.3, '#083308'); grad.addColorStop(0.6, '#0f4d0f'); grad.addColorStop(1, '#1a661a');
            ctx.fillStyle = grad; ctx.fillRect(0, 0, w, h);

            // Jungle silhouettes
            ctx.fillStyle = 'rgba(0, 15, 0, 0.5)';
            ctx.beginPath(); ctx.ellipse(0, 0, w * 0.5, h * 0.25, 0.4, 0, Math.PI * 2); ctx.fill();
            ctx.beginPath(); ctx.ellipse(w, 0, w * 0.45, h * 0.3, -0.4, 0, Math.PI * 2); ctx.fill();
            ctx.beginPath(); ctx.ellipse(0, h, w * 0.4, h * 0.2, -0.3, 0, Math.PI * 2); ctx.fill();
            ctx.beginPath(); ctx.ellipse(w, h, w * 0.35, h * 0.22, 0.3, 0, Math.PI * 2); ctx.fill();

            // Fireflies
            for (let i = 0; i < 35; i++) {
                const x = Math.random() * w, y = Math.random() * h, r = (2 + Math.random() * 4) * s;
                const glow = ctx.createRadialGradient(x, y, 0, x, y, r * 6);
                glow.addColorStop(0, 'rgba(255, 240, 100, 0.9)'); glow.addColorStop(0.4, 'rgba(255, 200, 50, 0.4)'); glow.addColorStop(1, 'rgba(255, 150, 0, 0)');
                ctx.fillStyle = glow; ctx.beginPath(); ctx.arc(x, y, r * 6, 0, Math.PI * 2); ctx.fill();
            }
        }

        // NEON - Vibrant arcade
        function drawNeon(ctx, w, h, s) {
            ctx.fillStyle = '#080010'; ctx.fillRect(0, 0, w, h);

            // Neon gradient wash
            const neon = ctx.createLinearGradient(0, 0, w, h);
            neon.addColorStop(0, 'rgba(255, 0, 150, 0.35)'); neon.addColorStop(0.5, 'rgba(0, 200, 255, 0.25)'); neon.addColorStop(1, 'rgba(150, 0, 255, 0.35)');
            ctx.fillStyle = neon; ctx.fillRect(0, 0, w, h);

            // Glow spots
            [[0.2, 0.2, 0.4, 'rgba(255, 0, 200, 0.3)'], [0.8, 0.3, 0.35, 'rgba(0, 255, 255, 0.25)'], [0.5, 0.8, 0.45, 'rgba(200, 0, 255, 0.25)'], [0.1, 0.7, 0.3, 'rgba(0, 255, 150, 0.2)']].forEach(([gx, gy, gr, gc]) => {
                const g = ctx.createRadialGradient(w * gx, h * gy, 0, w * gx, h * gy, w * gr);
                g.addColorStop(0, gc); g.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = g; ctx.fillRect(0, 0, w, h);
            });

            // Grid
            ctx.strokeStyle = 'rgba(255, 0, 255, 0.12)'; ctx.lineWidth = 1.5 * s;
            for (let x = 0; x < w; x += 50 * s) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, h); ctx.stroke(); }
            for (let y = 0; y < h; y += 50 * s) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke(); }
        }

        // WHITE HEAT - Clean hot white (with black text)
        function drawWhiteHeat(ctx, w, h, s) {
            const grad = ctx.createLinearGradient(0, 0, 0, h);
            grad.addColorStop(0, '#ffffff'); grad.addColorStop(0.3, '#f8f4f0'); grad.addColorStop(0.7, '#f0e8e0'); grad.addColorStop(1, '#e8ddd0');
            ctx.fillStyle = grad; ctx.fillRect(0, 0, w, h);

            // Heat glow
            const heat = ctx.createRadialGradient(w * 0.5, h * 0.35, 0, w * 0.5, h * 0.35, w * 0.8);
            heat.addColorStop(0, 'rgba(255, 200, 150, 0.35)'); heat.addColorStop(0.5, 'rgba(255, 220, 180, 0.15)'); heat.addColorStop(1, 'rgba(255,255,255,0)');
            ctx.fillStyle = heat; ctx.fillRect(0, 0, w, h);

            // Shimmer lines
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)'; ctx.lineWidth = 2.5 * s;
            for (let i = 0; i < 10; i++) {
                ctx.beginPath();
                for (let x = 0; x <= w; x += 20) {
                    const y = h * (0.08 + i * 0.09) + Math.sin(x * 0.007 + i * 0.5) * 25 * s;
                    x === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
        }

        // DOG TAG - Military camo
        function drawDogTag(ctx, w, h, s) {
            const grad = ctx.createLinearGradient(0, 0, w, h);
            grad.addColorStop(0, '#2a352a'); grad.addColorStop(0.5, '#3a4a3a'); grad.addColorStop(1, '#4a5a4a');
            ctx.fillStyle = grad; ctx.fillRect(0, 0, w, h);

            // Camo blobs
            const camo = ['rgba(35, 45, 30, 0.5)', 'rgba(50, 65, 45, 0.45)', 'rgba(70, 85, 60, 0.35)', 'rgba(30, 40, 25, 0.5)'];
            for (let i = 0; i < 25; i++) {
                ctx.fillStyle = camo[Math.floor(Math.random() * camo.length)];
                ctx.beginPath();
                ctx.ellipse(Math.random() * w, Math.random() * h, (100 + Math.random() * 180) * s, (60 + Math.random() * 120) * s, Math.random() * Math.PI, 0, Math.PI * 2);
                ctx.fill();
            }

            // Dog tag chain
            ctx.strokeStyle = 'rgba(180, 180, 180, 0.2)'; ctx.lineWidth = 5 * s;
            ctx.beginPath(); ctx.moveTo(w * 0.35, 0); ctx.quadraticCurveTo(w * 0.25, h * 0.12, w * 0.5, h * 0.18); ctx.stroke();
        }

        // DISCO - Groovy 70s
        function drawDisco(ctx, w, h, s) {
            const grad = ctx.createLinearGradient(0, 0, 0, h);
            grad.addColorStop(0, '#3d1a00'); grad.addColorStop(0.3, '#6b3300'); grad.addColorStop(0.6, '#994d00'); grad.addColorStop(1, '#7a3000');
            ctx.fillStyle = grad; ctx.fillRect(0, 0, w, h);

            // Disco ball rays
            const cx = w * 0.5, cy = h * 0.2;
            ctx.globalAlpha = 0.18;
            for (let i = 0; i < 28; i++) {
                const angle = (Math.PI * 2 / 28) * i;
                const g = ctx.createLinearGradient(cx, cy, cx + Math.cos(angle) * w, cy + Math.sin(angle) * h);
                g.addColorStop(0, 'rgba(255, 215, 0, 0.9)'); g.addColorStop(1, 'rgba(255, 100, 50, 0)');
                ctx.fillStyle = g; ctx.beginPath();
                ctx.moveTo(cx, cy); ctx.lineTo(cx + Math.cos(angle - 0.06) * w, cy + Math.sin(angle - 0.06) * h);
                ctx.lineTo(cx + Math.cos(angle + 0.06) * w, cy + Math.sin(angle + 0.06) * h); ctx.fill();
            }
            ctx.globalAlpha = 1;

            // Sparkles
            for (let i = 0; i < 50; i++) {
                const x = Math.random() * w, y = Math.random() * h, sz = (4 + Math.random() * 8) * s;
                ctx.fillStyle = `rgba(255, 215, 0, ${0.25 + Math.random() * 0.4})`;
                ctx.fillRect(x - sz / 2, y - sz / 2, sz, sz);
            }
        }

        // PINK - Barbie dreams
        function drawPink(ctx, w, h, s) {
            const grad = ctx.createLinearGradient(0, 0, 0, h);
            grad.addColorStop(0, '#ff0080'); grad.addColorStop(0.3, '#ff4da6'); grad.addColorStop(0.6, '#ff80bf'); grad.addColorStop(1, '#ffb3d9');
            ctx.fillStyle = grad; ctx.fillRect(0, 0, w, h);

            // Glitter
            for (let i = 0; i < 70; i++) {
                const x = Math.random() * w, y = Math.random() * h, r = (2 + Math.random() * 5) * s;
                const g = ctx.createRadialGradient(x, y, 0, x, y, r * 2.5);
                g.addColorStop(0, 'rgba(255, 255, 255, 0.85)'); g.addColorStop(1, 'rgba(255, 255, 255, 0)');
                ctx.fillStyle = g; ctx.beginPath(); ctx.arc(x, y, r * 2.5, 0, Math.PI * 2); ctx.fill();
            }

            // Hearts
            ctx.fillStyle = 'rgba(255, 255, 255, 0.12)';
            for (let i = 0; i < 10; i++) {
                const x = Math.random() * w, y = Math.random() * h, sz = (50 + Math.random() * 80) * s;
                ctx.save(); ctx.translate(x, y); ctx.scale(sz / 100, sz / 100);
                ctx.beginPath(); ctx.moveTo(0, -10); ctx.bezierCurveTo(-25, -35, -50, -10, 0, 30); ctx.bezierCurveTo(50, -10, 25, -35, 0, -10);
                ctx.fill(); ctx.restore();
            }
        }

        document.getElementById('downloadBtn').addEventListener('click', function () {
            const link = document.createElement('a');
            link.download = `atlantis-${currentYear}-lockscreen.png`;
            link.href = document.getElementById('wallpaperCanvas').toDataURL('image/png');
            link.click();
        });
    </script>
</body>

</html>